### Hetzner's default network, modified to fit a bridge
# Loopback device:
auto lo
iface lo inet loopback

# device: <%= @interface %>
auto  <%= @bridge %>
iface <%= @bridge %> inet static
  address   <%= @ip %>
  broadcast <%= @broadcast %>
  netmask   <%= @netmask %>
  gateway   <%= @gateway %>
  bridge_ports <%= @interface %>
  bridge_stp on
  bridge_maxwait 0
  # Set-up IPv6 and Hetzner routes
  # guarantee idempotency:
  pre-up ip addr del <%= @ipv6 -%>::1/64 dev <%= @bridge %> || true
  pre-up ip addr del <%= @ipv6 -%>::e4:1/112 dev <%= @bridge %> || true
  # add IPv6 address, e4 == "external" IPv6 network
  up ip addr add <%= @ipv6 -%>::1/64 dev <%= @bridge %>
  up ip addr add <%= @ipv6 -%>::e4:1/112 dev <%= @bridge %>
  # default route to access subnet
  # idempotency here is easier, because we have 'replace'
  up ip route replace to <%= @network -%>/<%= @netmask %> via <%= @gateway %> dev <%= @bridge %>
  # add Hetzner IPv6 route
  up ip route replace default via fe80::1 dev <%= @bridge %>

